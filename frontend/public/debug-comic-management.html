<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>漫画管理页面调试</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .button {
            background-color: #2196F3;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        .button:hover {
            background-color: #1976D2;
        }
        .result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
        }
        .success {
            background-color: #e8f5e8;
            color: #2e7d32;
            border: 1px solid #4caf50;
        }
        .error {
            background-color: #ffebee;
            color: #c62828;
            border: 1px solid #f44336;
        }
        .info {
            background-color: #e3f2fd;
            color: #1976d2;
            border: 1px solid #2196f3;
        }
        .url-box {
            background-color: #f5f5f5;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            font-family: monospace;
            word-break: break-all;
        }
        .step {
            margin: 15px 0;
            padding: 15px;
            border-left: 4px solid #2196F3;
            background-color: #f8f9fa;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🎯 漫画管理页面调试工具</h1>

        <div class="step">
            <h3>📍 当前项目信息</h3>
            <p><strong>项目ID:</strong> 2025.10.26_00.40_疯狂山脉</p>
            <p><strong>后端API:</strong> http://localhost:8000</p>
            <p><strong>前端应用:</strong> http://localhost:3000</p>
        </div>

        <div class="step">
            <h3>🔗 正确的访问方式</h3>
            <p>要访问漫画管理页面，请按以下步骤：</p>
            <ol>
                <li>打开浏览器访问: <a href="http://localhost:3000" target="_blank">http://localhost:3000</a></li>
                <li>导航到项目页面: <a href="http://localhost:3000/projects" target="_blank">http://localhost:3000/projects</a></li>
                <li>找到项目 "2025.10.26_00.40_疯狂山脉" 并点击进入</li>
                <li>在项目页面中，点击 "漫画管理" 标签页（第4个标签）</li>
            </ol>
            <p>⚠️ <strong>注意：</strong>漫画管理页面不是一个独立的URL，而是项目页面内的一个标签页。</p>
        </div>

        <div class="step">
            <h3>🧪 API测试工具</h3>
            <p>点击下面的按钮测试各个API端点：</p>

            <button class="button" onclick="testChaptersAPI()">测试章节数据API</button>
            <button class="button" onclick="testCoversAPI()">测试封面数据API</button>
            <button class="button" onclick="testProjectAPI()">测试项目详情API</button>
            <button class="button" onclick="clearResults()">清除结果</button>

            <div id="results"></div>
        </div>

        <div class="step">
            <h3>🐛 调试步骤</h3>
            <ol>
                <li>先测试上面的API按钮，确保后端正常工作</li>
                <li>打开浏览器开发者工具（F12）</li>
                <li>查看Console标签页中的调试信息</li>
                <li>按照上面的访问方式进入漫画管理页面</li>
                <li>观察控制台中的调试日志输出</li>
            </ol>
        </div>
    </div>

    <script>
        function addResult(message, type = 'info') {
            const resultsDiv = document.getElementById('results');
            const resultDiv = document.createElement('div');
            resultDiv.className = `result ${type}`;
            resultDiv.innerHTML = `<strong>[${new Date().toLocaleTimeString()}]</strong> ${message}`;
            resultsDiv.appendChild(resultDiv);
        }

        function clearResults() {
            document.getElementById('results').innerHTML = '';
        }

        async function testChaptersAPI() {
            addResult('🔄 测试章节数据API...', 'info');
            const projectId = '2025.10.26_00.40_疯狂山脉';
            const url = `/api/comics/${encodeURIComponent(projectId)}/chapters`;

            try {
                const response = await fetch(url);
                addResult(`📡 API请求: ${url}`, 'info');
                addResult(`📊 响应状态: ${response.status} ${response.statusText}`, response.ok ? 'success' : 'error');

                if (response.ok) {
                    const data = await response.json();
                    addResult(`✅ 章节数据加载成功: 找到 ${data.length} 个章节`, 'success');
                    data.forEach((chapter, index) => {
                        addResult(`📖 章节${index + 1}: ${chapter.title} (状态: ${chapter.status}, 进度: ${chapter.confirmed_panels}/${chapter.total_panels})`, 'info');
                    });
                } else {
                    const errorText = await response.text();
                    addResult(`❌ API请求失败: ${errorText}`, 'error');
                }
            } catch (error) {
                addResult(`❌ 网络错误: ${error.message}`, 'error');
            }
        }

        async function testCoversAPI() {
            addResult('🔄 测试封面数据API...', 'info');
            const projectId = '2025.10.26_00.40_疯狂山脉';
            const url = `/api/comics/${encodeURIComponent(projectId)}/covers`;

            try {
                const response = await fetch(url);
                addResult(`📡 API请求: ${url}`, 'info');
                addResult(`📊 响应状态: ${response.status} ${response.statusText}`, response.ok ? 'success' : 'error');

                if (response.ok) {
                    const data = await response.json();
                    const hasPrimary = data.primary_cover ? '有' : '无';
                    const chapterCount = data.chapter_covers ? data.chapter_covers.length : 0;
                    addResult(`✅ 封面数据加载成功: 项目封面${hasPrimary}, 章节封面${chapterCount}个`, 'success');
                } else {
                    const errorText = await response.text();
                    addResult(`❌ API请求失败: ${errorText}`, 'error');
                }
            } catch (error) {
                addResult(`❌ 网络错误: ${error.message}`, 'error');
            }
        }

        async function testProjectAPI() {
            addResult('🔄 测试项目详情API...', 'info');
            const projectId = '2025.10.26_00.40_疯狂山脉';
            const url = `/api/projects/${encodeURIComponent(projectId)}`;

            try {
                const response = await fetch(url);
                addResult(`📡 API请求: ${url}`, 'info');
                addResult(`📊 响应状态: ${response.status} ${response.statusText}`, response.ok ? 'success' : 'error');

                if (response.ok) {
                    const data = await response.json();
                    addResult(`✅ 项目详情加载成功: ${data.name} (状态: ${data.status})`, 'success');
                    addResult(`📝 项目描述: ${data.description || '无'}`, 'info');
                } else {
                    const errorText = await response.text();
                    addResult(`❌ API请求失败: ${errorText}`, 'error');
                }
            } catch (error) {
                addResult(`❌ 网络错误: ${error.message}`, 'error');
            }
        }

        // 页面加载时的说明
        window.onload = function() {
            addResult('🎯 漫画管理调试页面已加载', 'success');
            addResult('📝 请先测试API按钮，然后按照说明访问React应用', 'info');
        };
    </script>
</body>
</html>