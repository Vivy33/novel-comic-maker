<!DOCTYPE html>
<html>
<head>
    <title>API测试</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body>
    <h1>API测试页面</h1>

    <div>
        <h2>测试图生图API</h2>
        <button onclick="testImageToImage()">测试图生图</button>
        <pre id="result"></pre>
    </div>

    <script>
        async function testImageToImage() {
            const resultDiv = document.getElementById('result');
            resultDiv.textContent = '测试中...';

            try {
                // 创建一个简单的1x1像素图片用于测试
                const canvas = document.createElement('canvas');
                canvas.width = 100;
                canvas.height = 100;
                const ctx = canvas.getContext('2d');
                ctx.fillStyle = 'blue';
                ctx.fillRect(0, 0, 100, 100);

                // 转换为blob
                const blob = await new Promise(resolve => canvas.toBlob(resolve, 'image/png'));
                const file = new File([blob], 'test.png', { type: 'image/png' });

                const formData = new FormData();
                formData.append('prompt', '生成一个测试图片');
                formData.append('file', file);
                formData.append('model_preference', 'doubao-seedream-4-0-250828');
                formData.append('size', '1024x1024');
                formData.append('strength', '0.8');
                formData.append('stream', 'true');

                console.log('发送请求到:', '/api/image-edit/image-to-image');
                console.log('FormData内容:');
                for (let [key, value] of formData.entries()) {
                    console.log(key, value);
                }

                const response = await axios.post('/api/image-edit/image-to-image', formData, {
                    // 不要设置Content-Type，让浏览器自动处理
                });

                console.log('响应:', response);
                resultDiv.textContent = '成功！\n' + JSON.stringify(response.data, null, 2);

            } catch (error) {
                console.error('错误:', error);
                resultDiv.textContent = '错误：\n' + error.message + '\n\n详细信息：\n' + JSON.stringify(error.response?.data, null, 2);
            }
        }
    </script>
</body>
</html>