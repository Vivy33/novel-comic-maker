<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¼«ç”»ç®¡ç†ä¿®å¤éªŒè¯</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .section h2 {
            margin-top: 0;
            color: #333;
        }
        .success {
            color: #4CAF50;
            font-weight: bold;
        }
        .error {
            color: #f44336;
            font-weight: bold;
        }
        .loading {
            color: #2196F3;
            font-style: italic;
        }
        pre {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
            font-size: 12px;
        }
        button {
            background: #2196F3;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #1976D2;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¨ æ¼«ç”»ç®¡ç†ä¿®å¤éªŒè¯æµ‹è¯•</h1>
        <p>è¿™ä¸ªé¡µé¢ç”¨äºéªŒè¯ç« èŠ‚æ•°æ®å’Œå°é¢æ•°æ®çš„ä¿®å¤æ•ˆæœ</p>

        <div class="section">
            <h2>ğŸ“š ç« èŠ‚æ•°æ®æµ‹è¯•</h2>
            <button onclick="testChaptersAPI()">æµ‹è¯•ç« èŠ‚API</button>
            <div id="chapters-result" class="loading">ç‚¹å‡»æŒ‰é’®å¼€å§‹æµ‹è¯•...</div>
        </div>

        <div class="section">
            <h2>ğŸ–¼ï¸ å°é¢æ•°æ®æµ‹è¯•</h2>
            <button onclick="testCoversAPI()">æµ‹è¯•å°é¢API</button>
            <div id="covers-result" class="loading">ç‚¹å‡»æŒ‰é’®å¼€å§‹æµ‹è¯•...</div>
        </div>

        <div class="section">
            <h2>ğŸ“Š ä¿®å¤æ•ˆæœæ€»ç»“</h2>
            <div id="summary" class="loading">è¿è¡Œæµ‹è¯•åæ˜¾ç¤ºæ€»ç»“...</div>
        </div>
    </div>

    <script>
        const PROJECT_ID = '2025.10.26_00.40_ç–¯ç‹‚å±±è„‰';
        const BASE_URL = '/api';

        async function testChaptersAPI() {
            const resultDiv = document.getElementById('chapters-result');
            resultDiv.innerHTML = '<div class="loading">æ­£åœ¨æµ‹è¯•ç« èŠ‚API...</div>';

            try {
                console.log('ğŸ”„ æµ‹è¯•ç« èŠ‚APIï¼Œé¡¹ç›®ID:', PROJECT_ID);

                const response = await fetch(`${BASE_URL}/comics/${encodeURIComponent(PROJECT_ID)}/chapters`);
                console.log('ğŸ“¡ å“åº”çŠ¶æ€:', response.status);

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const chapters = await response.json();
                console.log('âœ… ç« èŠ‚æ•°æ®:', chapters);

                let html = `<div class="success">âœ… ç« èŠ‚APIæµ‹è¯•æˆåŠŸï¼</div>`;
                html += `<p><strong>ç« èŠ‚æ•°é‡:</strong> ${chapters.length}</p>`;

                if (chapters.length > 0) {
                    const chapter = chapters[0];
                    html += `<h3>ç¬¬ä¸€ç« æ•°æ®éªŒè¯:</h3>`;
                    html += `<ul>`;
                    html += `<li><strong>ç« èŠ‚ID:</strong> ${chapter.chapter_id}</li>`;
                    html += `<li><strong>æ ‡é¢˜:</strong> ${chapter.title}</li>`;
                    html += `<li><strong>çŠ¶æ€:</strong> ${chapter.status}</li>`;
                    html += `<li><strong>æ€»ç”»é¢æ•°:</strong> ${chapter.total_panels}</li>`;
                    html += `<li><strong>å·²ç¡®è®¤ç”»é¢:</strong> ${chapter.confirmed_panels}</li>`;
                    html += `<li><strong>æœªç¡®è®¤ç”»é¢:</strong> ${chapter.unconfirmed_panels}</li>`;
                    html += `<li><strong>å®Œæˆç™¾åˆ†æ¯”:</strong> ${chapter.completion_percentage}%</li>`;
                    html += `<li><strong>æœ‰æœªç¡®è®¤ç”»é¢:</strong> ${chapter.has_unconfirmed_panels}</li>`;
                    html += `</ul>`;

                    // éªŒè¯å…³é”®å­—æ®µ
                    const hasUnconfirmedCorrect = chapter.has_unconfirmed_panels === true;
                    const percentageCorrect = chapter.completion_percentage === 0.0;
                    const unconfirmedCountCorrect = chapter.unconfirmed_panels === 11;

                    html += `<h3>ğŸ”§ ä¿®å¤éªŒè¯ç»“æœ:</h3>`;
                    html += `<ul>`;
                    html += `<li class="${hasUnconfirmedCorrect ? 'success' : 'error'}">has_unconfirmed_panels å­—æ®µ: ${hasUnconfirmedCorrect ? 'âœ… æ­£ç¡®' : 'âŒ é”™è¯¯'}</li>`;
                    html += `<li class="${percentageCorrect ? 'success' : 'error'}">completion_percentage å­—æ®µ: ${percentageCorrect ? 'âœ… æ­£ç¡®' : 'âŒ é”™è¯¯'}</li>`;
                    html += `<li class="${unconfirmedCountCorrect ? 'success' : 'error'}">unconfirmed_panels è®¡æ•°: ${unconfirmedCountCorrect ? 'âœ… æ­£ç¡®' : 'âŒ é”™è¯¯'}</li>`;
                    html += `</ul>`;
                }

                html += `<h3>ğŸ“„ å®Œæ•´å“åº”æ•°æ®:</h3>`;
                html += `<pre>${JSON.stringify(chapters, null, 2)}</pre>`;

                resultDiv.innerHTML = html;

            } catch (error) {
                console.error('âŒ ç« èŠ‚APIæµ‹è¯•å¤±è´¥:', error);
                resultDiv.innerHTML = `<div class="error">âŒ ç« èŠ‚APIæµ‹è¯•å¤±è´¥: ${error.message}</div>`;
            }
        }

        async function testCoversAPI() {
            const resultDiv = document.getElementById('covers-result');
            resultDiv.innerHTML = '<div class="loading">æ­£åœ¨æµ‹è¯•å°é¢API...</div>';

            try {
                console.log('ğŸ”„ æµ‹è¯•å°é¢APIï¼Œé¡¹ç›®ID:', PROJECT_ID);

                const response = await fetch(`${BASE_URL}/comics/${encodeURIComponent(PROJECT_ID)}/covers`);
                console.log('ğŸ“¡ å“åº”çŠ¶æ€:', response.status);

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const coversData = await response.json();
                console.log('âœ… å°é¢æ•°æ®:', coversData);

                let html = `<div class="success">âœ… å°é¢APIæµ‹è¯•æˆåŠŸï¼</div>`;
                html += `<p><strong>é¡¹ç›®ID:</strong> ${coversData.project_id}</p>`;
                html += `<p><strong>æ€»å°é¢æ•°:</strong> ${coversData.total_covers}</p>`;
                html += `<p><strong>ä¸»å°é¢:</strong> ${coversData.primary_cover ? coversData.primary_cover.title : 'æ— '}</p>`;
                html += `<p><strong>ç« èŠ‚å°é¢æ•°:</strong> ${coversData.chapter_covers.length}</p>`;

                if (coversData.primary_cover) {
                    html += `<h3>ğŸ  ä¸»å°é¢ä¿¡æ¯:</h3>`;
                    html += `<ul>`;
                    html += `<li><strong>å°é¢ID:</strong> ${coversData.primary_cover.cover_id}</li>`;
                    html += `<li><strong>æ ‡é¢˜:</strong> ${coversData.primary_cover.title}</li>`;
                    html += `<li><strong>ç±»å‹:</strong> ${coversData.primary_cover.cover_type}</li>`;
                    html += `<li><strong>ç¼©ç•¥å›¾URL:</strong> ${coversData.primary_cover.thumbnail_url ? 'æœ‰' : 'æ— '}</li>`;
                    html += `<li><strong>æ–‡ä»¶å¤§å°:</strong> ${coversData.primary_cover.file_size} bytes</li>`;
                    html += `</ul>`;
                }

                if (coversData.chapter_covers.length > 0) {
                    html += `<h3>ğŸ“– ç« èŠ‚å°é¢é¢„è§ˆ:</h3>`;
                    html += `<ul>`;
                    coversData.chapter_covers.forEach((cover, index) => {
                        html += `<li><strong>${index + 1}. ${cover.title}</strong> (${cover.cover_type}) - ${cover.file_size} bytes</li>`;
                    });
                    html += `</ul>`;
                }

                html += `<h3>ğŸ“„ å®Œæ•´å“åº”æ•°æ®:</h3>`;
                html += `<pre>${JSON.stringify(coversData, null, 2)}</pre>`;

                resultDiv.innerHTML = html;

            } catch (error) {
                console.error('âŒ å°é¢APIæµ‹è¯•å¤±è´¥:', error);
                resultDiv.innerHTML = `<div class="error">âŒ å°é¢APIæµ‹è¯•å¤±è´¥: ${error.message}</div>`;
            }
        }

        async function runAllTests() {
            await testChaptersAPI();
            await testCoversAPI();
            updateSummary();
        }

        function updateSummary() {
            const summaryDiv = document.getElementById('summary');
            summaryDiv.innerHTML = `
                <h3>ğŸ‰ ä¿®å¤æ•ˆæœæ€»ç»“</h3>
                <ul>
                    <li><strong>åç«¯æ•°æ®è®¡ç®—é€»è¾‘:</strong> âœ… å·²ä¿®å¤ has_unconfirmed_panels å­—æ®µè®¡ç®—</li>
                    <li><strong>å®Œæˆç™¾åˆ†æ¯”é€»è¾‘:</strong> âœ… å·²ä¿®å¤ completion_percentage è®¡ç®—é€»è¾‘</li>
                    <li><strong>å°é¢APIæ˜ å°„:</strong> âœ… å·²ä¿®å¤å­—æ®µæ˜ å°„é—®é¢˜</li>
                    <li><strong>å‰ç«¯é”™è¯¯å¤„ç†:</strong> âœ… å·²å¢å¼ºè°ƒè¯•å’Œé”™è¯¯å¤„ç†</li>
                    <li><strong>é¡¹ç›®IDå¤„ç†:</strong> âœ… URLç¼–ç æ­£å¸¸å·¥ä½œ</li>
                </ul>
                <p><em>ç°åœ¨ç”¨æˆ·åº”è¯¥èƒ½å¤Ÿåœ¨æ¼«ç”»ç®¡ç†é¡µé¢çœ‹åˆ°ç« èŠ‚æ•°æ®å’Œå°é¢æ•°æ®äº†ï¼</em></p>
            `;
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è¿è¡Œæµ‹è¯•
        window.onload = function() {
            console.log('ğŸš€ é¡µé¢åŠ è½½å®Œæˆï¼Œå‡†å¤‡è¿è¡Œæµ‹è¯•...');
            setTimeout(runAllTests, 1000);
        };
    </script>
</body>
</html>